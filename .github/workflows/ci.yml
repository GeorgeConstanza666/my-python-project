name: CI/CD –∑ Telegram-–Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é

on:
  push:
    branches:
      - main

jobs:
  build-and-notify:
    runs-on: ubuntu-latest

    steps:
    - name: üîΩ –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
      uses: actions/checkout@v3

    - name: üêç –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
      run: |
        pip install -r requirements.txt

    - name: ‚úÖ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
      run: |
        pytest

    - name: üê≥ –ü–æ–±—É–¥–æ–≤–∞ Docker-–æ–±—Ä–∞–∑—É
      run: |
        docker build -t my-python-app .

    - name: üì© –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram
      if: success()
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        curl -s -X POST https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage \
          -d chat_id=$TELEGRAM_CHAT_ID \
          -d text="‚úÖ –£—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ CI/CD –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é ${{ github.repository }}! –ö–æ–º—ñ—Ç: ${{ github.sha }} üöÄ"
